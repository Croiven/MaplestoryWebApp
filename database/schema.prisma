generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model DiscordUser {
  id            String    @id @default(cuid())
  discordId     String    @unique
  username      String
  discriminator String?
  avatar        String?
  accessToken   String?
  refreshToken  String?
  expiresAt     DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  characters    Character[]

  @@map("discord_users")
}

model Character {
  id           String      @id @default(cuid())
  name         String
  level        Int
  job          String
  world        String
  avatar       String?     // Character avatar URL
  experience   BigInt?     // Character experience points
  main         Boolean     @default(false) // Main character flag
  stats        Json        // Character stats object with all MapleStory stats
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  discordUserId String
  discordUser  DiscordUser @relation(fields: [discordUserId], references: [id], onDelete: Cascade)
  history      CharacterHistory[]
  progression  CharacterProgression[]

  @@map("characters")
}

model CharacterHistory {
  id           String      @id @default(cuid())
  characterId  String
  character    Character   @relation(fields: [characterId], references: [id], onDelete: Cascade)
  level        Int
  job          String
  world        String
  avatar       String?
  experience   BigInt?
  stats        Json
  createdAt    DateTime    @default(now())

  @@map("character_history")
}

model CharacterProgression {
  id           String      @id @default(cuid())
  characterId  String
  character    Character   @relation(fields: [characterId], references: [id], onDelete: Cascade)
  level        Int
  experience   BigInt      // Use BigInt for large experience values
  rank         Int?        // Ranking position
  legionLevel  Int?        // Legion level
  raidPower    Int?        // Raid power
  lastUpdated  DateTime    @default(now())

  @@map("character_progression")
}

